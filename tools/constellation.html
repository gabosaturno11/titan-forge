<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CONSTELLATION | Routine Builder</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        :root { --bg: #0a0a0a; --blue: #00D4FF; --purple: #9D4EDD; --star: #FFD700; }
        body { font-family: 'JetBrains Mono', monospace; background: var(--bg); color: #fff; min-height: 100vh; overflow-x: hidden; }

        .container { max-width: 500px; margin: 0 auto; padding: 20px; min-height: 100vh; }

        .header { text-align: center; margin-bottom: 20px; }
        .logo { width: 50px; height: 50px; margin: 0 auto 10px; background: linear-gradient(135deg, var(--blue), var(--purple)); border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .logo-text { font-size: 9px; font-weight: 700; letter-spacing: 1px; }
        .header h1 { font-size: 18px; font-weight: 700; letter-spacing: 3px; background: linear-gradient(135deg, var(--blue), var(--purple)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-transform: uppercase; }
        .header p { font-size: 9px; color: #666; margin-top: 4px; letter-spacing: 2px; }

        .sky { position: relative; width: 100%; height: 280px; background: radial-gradient(circle at 50% 50%, #0d0d1a, var(--bg)); border-radius: 12px; margin-bottom: 20px; overflow: hidden; }
        .star { position: absolute; width: 12px; height: 12px; border-radius: 50%; background: var(--star); cursor: pointer; transition: all 0.3s; box-shadow: 0 0 10px var(--star); z-index: 2; }
        .star:hover { transform: scale(1.3); box-shadow: 0 0 20px var(--star); }
        .star.selected { background: var(--blue); box-shadow: 0 0 20px var(--blue); transform: scale(1.4); }
        .star.in-constellation { background: var(--purple); box-shadow: 0 0 15px var(--purple); }
        .star-label { position: absolute; font-size: 8px; color: #666; white-space: nowrap; pointer-events: none; transform: translateX(-50%); }

        .constellation-lines { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }

        .controls { display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap; justify-content: center; }
        .control-btn { padding: 8px 14px; border-radius: 6px; border: 1px solid #333; background: transparent; color: #666; font-family: 'JetBrains Mono', monospace; font-size: 9px; font-weight: 600; letter-spacing: 1px; cursor: pointer; transition: all 0.2s; text-transform: uppercase; }
        .control-btn:hover { border-color: var(--blue); color: var(--blue); }
        .control-btn.active { background: var(--blue); border-color: var(--blue); color: #000; }

        .routine-display { background: rgba(0, 212, 255, 0.05); border: 1px solid rgba(0, 212, 255, 0.2); border-radius: 12px; padding: 16px; margin-bottom: 16px; }
        .routine-title { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .routine-name { font-size: 12px; font-weight: 700; color: var(--blue); letter-spacing: 1px; }
        .routine-count { font-size: 10px; color: #666; }

        .routine-list { display: flex; flex-direction: column; gap: 6px; min-height: 100px; }
        .routine-item { display: flex; align-items: center; gap: 10px; padding: 8px; background: rgba(255, 255, 255, 0.02); border-radius: 6px; }
        .routine-num { width: 20px; height: 20px; border-radius: 50%; background: var(--purple); display: flex; align-items: center; justify-content: center; font-size: 9px; color: #fff; }
        .routine-ex-name { flex: 1; font-size: 11px; color: #888; }
        .routine-arrow { font-size: 10px; color: #333; }

        .action-row { display: flex; gap: 12px; justify-content: center; margin-bottom: 16px; }
        .btn { padding: 12px 24px; border-radius: 8px; border: 2px solid var(--purple); background: transparent; color: var(--purple); font-family: 'JetBrains Mono', monospace; font-size: 11px; font-weight: 700; letter-spacing: 2px; text-transform: uppercase; cursor: pointer; transition: all 0.2s; }
        .btn:hover { background: var(--purple); color: #000; }
        .btn.start-btn { border-color: var(--blue); color: var(--blue); }
        .btn.start-btn:hover { background: var(--blue); }

        .saved-routines { background: rgba(157, 78, 221, 0.05); border: 1px solid rgba(157, 78, 221, 0.2); border-radius: 12px; padding: 16px; }
        .saved-title { font-size: 10px; color: #666; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 12px; }
        .saved-list { display: flex; flex-direction: column; gap: 8px; }
        .saved-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(255, 255, 255, 0.02); border-radius: 6px; cursor: pointer; transition: all 0.2s; }
        .saved-item:hover { background: rgba(157, 78, 221, 0.1); }
        .saved-item-name { font-size: 11px; color: #888; }
        .saved-item-count { font-size: 10px; color: var(--purple); }

        .sound-toggle { position: fixed; top: 16px; right: 16px; background: rgba(10, 10, 10, 0.9); border: 1px solid #333; border-radius: 8px; padding: 8px 12px; font-family: 'JetBrains Mono', monospace; font-size: 10px; color: #666; cursor: pointer; z-index: 100; }
        .sound-toggle:hover { border-color: var(--blue); color: var(--blue); }
        .sound-toggle.active { color: var(--blue); border-color: var(--blue); }
    </style>
</head>
<body>
    <button class="sound-toggle active" id="soundToggle">SFX: ON</button>

    <div class="container">
        <div class="header">
            <div class="logo"><span class="logo-text">SM</span></div>
            <h1>Constellation</h1>
            <p>Routine Builder</p>
        </div>

        <div class="sky" id="sky">
            <svg class="constellation-lines" id="constellationLines"></svg>
        </div>

        <div class="controls">
            <button class="control-btn active" data-cat="push">PUSH</button>
            <button class="control-btn" data-cat="pull">PULL</button>
            <button class="control-btn" data-cat="legs">LEGS</button>
            <button class="control-btn" data-cat="core">CORE</button>
        </div>

        <div class="routine-display">
            <div class="routine-title">
                <span class="routine-name">Your Constellation</span>
                <span class="routine-count" id="routineCount">0 exercises</span>
            </div>
            <div class="routine-list" id="routineList">
                <div style="color: #444; font-size: 10px; text-align: center; padding: 20px;">
                    Tap stars to connect exercises
                </div>
            </div>
        </div>

        <div class="action-row">
            <button class="btn" id="clearBtn">CLEAR</button>
            <button class="btn" id="saveBtn">SAVE</button>
            <button class="btn start-btn" id="startBtn">START</button>
        </div>

        <div class="saved-routines">
            <div class="saved-title">Saved Constellations</div>
            <div class="saved-list" id="savedList">
                <div style="color: #444; font-size: 10px; text-align: center;">No saved routines yet</div>
            </div>
        </div>
    </div>

    <script>
        let audioCtx = null, soundEnabled = true;
        function initAudio() { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); if (audioCtx.state === 'suspended') audioCtx.resume(); }

        function playSound(type) {
            if (!soundEnabled) return;
            initAudio();
            const now = audioCtx.currentTime;

            if (type === 'add') {
                const osc = audioCtx.createOscillator(), gain = audioCtx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(400, now);
                osc.frequency.exponentialRampToValueAtTime(800, now + 0.1);
                gain.gain.setValueAtTime(0.15, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
                osc.connect(gain); gain.connect(audioCtx.destination);
                osc.start(now); osc.stop(now + 0.15);
            } else if (type === 'connect') {
                const osc = audioCtx.createOscillator(), gain = audioCtx.createGain();
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(600, now);
                osc.frequency.exponentialRampToValueAtTime(1200, now + 0.15);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
                osc.connect(gain); gain.connect(audioCtx.destination);
                osc.start(now); osc.stop(now + 0.2);
            } else if (type === 'save') {
                for (let i = 0; i < 4; i++) {
                    setTimeout(() => {
                        const osc = audioCtx.createOscillator(), gain = audioCtx.createGain();
                        osc.type = 'sawtooth';
                        osc.frequency.setValueAtTime(300 + i * 100, audioCtx.currentTime);
                        gain.gain.setValueAtTime(0.15, audioCtx.currentTime);
                        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
                        osc.connect(gain); gain.connect(audioCtx.destination);
                        osc.start(audioCtx.currentTime); osc.stop(audioCtx.currentTime + 0.2);
                    }, i * 80);
                }
            }
        }

        const exercises = {
            push: [
                { name: 'Push-ups', x: 15, y: 20 },
                { name: 'Diamond Push', x: 40, y: 35 },
                { name: 'Pike Push', x: 70, y: 15 },
                { name: 'Dips', x: 85, y: 40 },
                { name: 'Archer Push', x: 25, y: 60 },
                { name: 'Wide Push', x: 55, y: 70 }
            ],
            pull: [
                { name: 'Pull-ups', x: 20, y: 25 },
                { name: 'Chin-ups', x: 50, y: 20 },
                { name: 'Rows', x: 75, y: 30 },
                { name: 'Archer Pull', x: 30, y: 55 },
                { name: 'L-sit Pull', x: 60, y: 65 },
                { name: 'Muscle-up', x: 85, y: 50 }
            ],
            legs: [
                { name: 'Squats', x: 25, y: 20 },
                { name: 'Lunges', x: 55, y: 30 },
                { name: 'Jump Squat', x: 80, y: 25 },
                { name: 'Pistol Squat', x: 20, y: 55 },
                { name: 'Calf Raises', x: 50, y: 70 },
                { name: 'Step-ups', x: 75, y: 60 }
            ],
            core: [
                { name: 'Plank', x: 30, y: 25 },
                { name: 'L-Sit', x: 60, y: 20 },
                { name: 'Hollow Body', x: 85, y: 35 },
                { name: 'Dragon Flag', x: 20, y: 60 },
                { name: 'Leg Raises', x: 50, y: 65 },
                { name: 'V-Ups', x: 75, y: 55 }
            ]
        };

        let state = {
            category: 'push',
            constellation: [],
            savedRoutines: JSON.parse(localStorage.getItem('constellation_saved') || '[]')
        };

        function renderStars() {
            const sky = document.getElementById('sky');
            const svg = document.getElementById('constellationLines');

            // Clear existing stars (keep svg)
            sky.querySelectorAll('.star, .star-label').forEach(el => el.remove());

            const exs = exercises[state.category];
            exs.forEach((ex, i) => {
                const star = document.createElement('div');
                star.className = 'star';
                if (state.constellation.find(c => c.name === ex.name)) {
                    star.classList.add('in-constellation');
                }
                star.style.left = ex.x + '%';
                star.style.top = ex.y + '%';
                star.dataset.name = ex.name;
                star.addEventListener('click', () => addToConstellation(ex));
                sky.appendChild(star);

                const label = document.createElement('div');
                label.className = 'star-label';
                label.textContent = ex.name;
                label.style.left = ex.x + '%';
                label.style.top = (ex.y + 8) + '%';
                sky.appendChild(label);
            });

            renderLines();
        }

        function renderLines() {
            const svg = document.getElementById('constellationLines');
            svg.innerHTML = '';

            if (state.constellation.length < 2) return;

            const sky = document.getElementById('sky');
            const rect = sky.getBoundingClientRect();

            for (let i = 0; i < state.constellation.length - 1; i++) {
                const from = state.constellation[i];
                const to = state.constellation[i + 1];

                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', (from.x / 100) * rect.width + 6);
                line.setAttribute('y1', (from.y / 100) * rect.height + 6);
                line.setAttribute('x2', (to.x / 100) * rect.width + 6);
                line.setAttribute('y2', (to.y / 100) * rect.height + 6);
                line.setAttribute('stroke', '#9D4EDD');
                line.setAttribute('stroke-width', '2');
                line.setAttribute('opacity', '0.6');
                svg.appendChild(line);
            }
        }

        function addToConstellation(ex) {
            if (state.constellation.find(c => c.name === ex.name)) {
                // Remove if already in constellation
                state.constellation = state.constellation.filter(c => c.name !== ex.name);
            } else {
                state.constellation.push({ ...ex });
                if (state.constellation.length > 1) {
                    playSound('connect');
                } else {
                    playSound('add');
                }
            }
            updateDisplay();
        }

        function updateDisplay() {
            renderStars();

            document.getElementById('routineCount').textContent = state.constellation.length + ' exercises';

            const list = document.getElementById('routineList');
            if (state.constellation.length === 0) {
                list.innerHTML = '<div style="color: #444; font-size: 10px; text-align: center; padding: 20px;">Tap stars to connect exercises</div>';
            } else {
                list.innerHTML = state.constellation.map((ex, i) => `
                    <div class="routine-item">
                        <div class="routine-num">${i + 1}</div>
                        <div class="routine-ex-name">${ex.name}</div>
                        ${i < state.constellation.length - 1 ? '<span class="routine-arrow">â†’</span>' : ''}
                    </div>
                `).join('');
            }

            renderSavedRoutines();
        }

        function clearConstellation() {
            state.constellation = [];
            updateDisplay();
        }

        function saveConstellation() {
            if (state.constellation.length < 2) return;

            const name = `Constellation ${state.savedRoutines.length + 1}`;
            state.savedRoutines.push({
                name,
                exercises: [...state.constellation]
            });
            localStorage.setItem('constellation_saved', JSON.stringify(state.savedRoutines));
            playSound('save');
            updateDisplay();
        }

        function loadConstellation(idx) {
            const routine = state.savedRoutines[idx];
            state.constellation = [...routine.exercises];
            playSound('add');
            updateDisplay();
        }

        function renderSavedRoutines() {
            const list = document.getElementById('savedList');
            if (state.savedRoutines.length === 0) {
                list.innerHTML = '<div style="color: #444; font-size: 10px; text-align: center;">No saved routines yet</div>';
            } else {
                list.innerHTML = state.savedRoutines.map((r, i) => `
                    <div class="saved-item" data-idx="${i}">
                        <span class="saved-item-name">${r.name}</span>
                        <span class="saved-item-count">${r.exercises.length} stars</span>
                    </div>
                `).join('');

                list.querySelectorAll('.saved-item').forEach(item => {
                    item.addEventListener('click', () => loadConstellation(parseInt(item.dataset.idx)));
                });
            }
        }

        document.querySelectorAll('.control-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.control-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                state.category = btn.dataset.cat;
                renderStars();
            });
        });

        document.getElementById('clearBtn').addEventListener('click', clearConstellation);
        document.getElementById('saveBtn').addEventListener('click', saveConstellation);
        document.getElementById('startBtn').addEventListener('click', () => {
            if (state.constellation.length > 0) {
                alert('Starting workout:\n\n' + state.constellation.map((ex, i) => `${i + 1}. ${ex.name}`).join('\n'));
            }
        });

        document.getElementById('soundToggle').addEventListener('click', () => {
            initAudio();
            soundEnabled = !soundEnabled;
            document.getElementById('soundToggle').textContent = soundEnabled ? 'SFX: ON' : 'SFX: OFF';
            document.getElementById('soundToggle').classList.toggle('active', soundEnabled);
        });

        window.addEventListener('resize', renderLines);
        updateDisplay();
    </script>
</body>
</html>
